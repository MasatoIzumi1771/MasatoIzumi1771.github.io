<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deep Research: Retrieval-Augmented Generation (RAG) 詳細解説</title>
    <link rel="stylesheet" href="../css/style.css"> <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script> <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* ここでは、style.cssとTailwind CSSの衝突を調整し、デザインの統一感を保ちます */
        /* body, h1, h2, h3, h4などの基本的なフォントや色、余白はstyle.cssが適用されます */

        /* Tailwindのtab-contentクラスは、style.cssのセクションとは別にこのページ内で制御 */
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* チャートコンテナのサイズと影の調整 */
        .chart-container { 
            position: relative; 
            width: 100%; 
            max-width: 700px; 
            margin-left: auto; 
            margin-right: auto; 
            height: 400px; 
            max-height: 450px; 
            background-color: #ffffff; /* 明示的に白背景 */
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); /* ソフトな影 */
            padding: 1rem;
            border: 1px solid #eef5fb;
        }

        /* アコーディオン要素のスタイル調整 */
        .accordion-content { 
            max-height: 0; 
            overflow: hidden; 
            transition: max-height 0.3s ease-out; 
        }
        .accordion-content.open { 
            max-height: 1000px; /* 必要に応じて調整 */ 
        }
        .accordion-toggle {
            background-color: #e3f2fd; /* 薄いブルー */
            color: #0056b3; /* 濃いブルー */
            font-weight: 600;
            transition: background-color 0.2s ease, transform 0.2s ease;
            width: 100%; /* 全幅 */
            text-align: left; /* 左寄せ */
            padding: 1rem; /* パディング */
            border-radius: 0.5rem; /* 角丸 */
            margin-bottom: 0.5rem; /* 下余白 */
            border: none; /* ボーダーなし */
        }
        .accordion-toggle:hover {
            background-color: #cce7ff; /* ホバー時の色 */
            transform: translateY(-1px);
        }
        .accordion-content {
            background-color: #fafdff; /* 薄い背景色 */
            border: 1px solid #eef5fb;
            border-top: none; 
            border-radius: 0 0 0.5rem 0.5rem; /* 下側の角だけ丸く */
            color: #444;
        }


        /* ナビゲーションリンクのスタイル調整 */
        .deep-research-nav-header {
            background-color: #1a73e8; /* メインヘッダーと同じブルー */
            color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            padding: 1.5rem 0; /* パディング調整 */
            border-radius: 10px 10px 0 0; /* 上側だけ角丸 */
        }
        .deep-research-nav-header h1 {
            font-family: 'Montserrat', sans-serif;
            color: white;
            font-size: 2.2rem; /* サイズ調整 */
            margin-bottom: 0.25rem;
        }
        .deep-research-nav-header p {
            color: #e0f2f7;
            font-size: 1.1rem;
        }
        .deep-research-nav-tabs {
            background-color: #0056b3; /* ヘッダーのナビゲーションカラー */
            padding: 0.75rem 0; /* パディング調整 */
            border-radius: 0 0 10px 10px; /* 下側だけ角丸 */
        }
        .deep-research-nav-tabs .nav-link {
            color: #e3f2fd; /* ナビリンクの色 */
            font-weight: 500;
            padding: 0.75rem 1rem; /* パディング調整 */
            border-radius: 0.375rem; /* 角丸 */
            font-size: 0.95rem; /* フォントサイズ調整 */
        }

        .deep-research-nav-tabs .nav-link.active {
            background-color: #007bff; /* アクティブなナビリンクの色 */
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transform: translateY(-2px);
        }
        .deep-research-nav-tabs .nav-link:hover {
            background-color: #007bff;
            color: white;
        }

        /* ツールチップのスタイル */
        .tooltip { 
            position: absolute; 
            background-color: rgba(0,0,0,0.8); 
            color: white; 
            padding: 5px 10px; 
            border-radius: 4px; 
            font-size: 0.875rem; 
            z-index: 10; 
            pointer-events: none; 
            opacity: 0; 
            transition: opacity 0.2s; 
        }
        .tooltip.visible { opacity: 1; }

        /* Diagram Component */
        .diagram-component { 
            border: 2px solid #60a5fa; 
            padding: 1rem; 
            border-radius: 0.5rem; 
            text-align: center; 
            cursor: pointer; 
            transition: background-color 0.2s, transform 0.2s ease; 
            background-color: #e3f2fd; /* 薄いブルー */
            color: #0056b3;
            font-weight: 600;
        }
        .diagram-component:hover { 
            background-color: #cce7ff; 
            transform: translateY(-2px);
        }
        .arrow { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            margin: 0 0.5rem; 
            font-size: 1.5rem; 
            color: #4285F4; /* 矢印の色を統一 */
        }

        /* Card styles - main style.cssで上書きされる可能性が高いが、Tailwindのクラスを保持 */
        .card { 
            background-color: white; 
            border-radius: 0.75rem; /* より丸く */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06); /* ソフトな影 */
            padding: 1.75rem; /* パディング調整 */
            margin-bottom: 1.5rem; /* 余白調整 */
            border: 1px solid #eef5fb; /* 薄いボーダー */
        }

        /* リストスタイル調整 */
        .list-disc li, .list-decimal li, .list-circle li {
            line-height: 1.6;
            margin-bottom: 0.5em;
            color: #444;
            font-size: 0.95em;
        }
        .list-inside {
            padding-left: 0; /* リストのインデントを調整 */
        }

        /* 特定の背景色とボーダーの調整 */
        .bg-sky-50 { background-color: #e3f2fd; } /* 薄いブルー */
        .border-sky-200 { border-color: #bbdefb; } /* 薄いブルーのボーダー */
        .text-sky-700 { color: #0288d1; } /* 濃いスカイブルー */
        .bg-red-50 { background-color: #ffebee; } /* 落ち着いた赤 */
        .border-red-200 { border-color: #ef9a9a; } /* 赤いボーダー */
        .text-red-700 { color: #c62828; } /* 濃い赤 */

        /* レスポンシブデザインの調整 */
        @media (max-width: 640px) {
            .deep-research-nav-header h1 {
                font-size: 1.8rem;
            }
            .deep-research-nav-tabs .nav-link {
                font-size: 0.8rem;
                padding: 0.5rem 0.75rem;
            }
            .flex-col.sm\\:flex-row {
                flex-direction: column;
            }
            .sm\\:space-y-0 {
                margin-top: 1rem;
            }
            .sm\\:space-x-4 {
                margin-left: 0;
            }
            .diagram-component {
                width: 100%;
                margin-bottom: 0.5rem;
            }
            .arrow {
                display: none; /* スマホでは矢印を非表示 */
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-inner">
            <h1 class="site-title"><a href="../index.html">Masato Izumi Portfolio</a></h1>
            <nav class="nav">
                <ul class="nav-list">
                    <li class="nav-item"><a href="../index.html">ホーム</a></li>
                    <li class="nav-item"><a href="../research_achievements.html">研究実績</a></li>
                    <li class="nav-item"><a href="../research.html">研究</a></li>
                    <li class="nav-item"><a href="../skills.html">スキル</a></li>
                    <li class="nav-item"><a href="../articles.html">研究記事</a></li>
                    <li class="nav-item"><a href="index.html">Deep Research</a></li> <li class="nav-item"><a href="../other.html">その他</a></li>
                </ul>
            </nav>
            <button class="menu-toggle" aria-label="メニューを開く">
                <span class="menu-icon"></span>
            </button>
        </div>
    </header>

    <main class="main-content">
        <section id="deep-research-rag" class="article-detail section"> <div class="container">
                <h2 class="article-title">Retrieval-Augmented Generation (RAG) 詳細解説</h2>
                <p class="article-meta">公開日: 2025.05.21</p> <div class="deep-research-nav-header text-center mb-6">
                    <h1 class="text-3xl font-bold tracking-tight">Retrieval-Augmented Generation (RAG) 詳細解説</h1>
                    <p class="mt-1 text-sky-100">LLM研究者のためのインタラクティブガイド</p>
                </div>
                <nav class="deep-research-nav-tabs">
                    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="flex flex-wrap justify-center space-x-2 sm:space-x-4 py-3">
                            <button class="nav-link active text-sm sm:text-base px-3 py-2 font-medium rounded-md hover:bg-sky-500 focus:outline-none focus:ring-2 focus:ring-sky-400" onclick="showTab('overview')">概要</button>
                            <button class="nav-link text-sm sm:text-base px-3 py-2 font-medium rounded-md hover:bg-sky-500 focus:outline-none focus:ring-2 focus:ring-sky-400" onclick="showTab('architecture')">基本アーキテクチャ</button>
                            <button class="nav-link text-sm sm:text-base px-3 py-2 font-medium rounded-md hover:bg-sky-500 focus:outline-none focus:ring-2 focus:ring-400" onclick="showTab('technologies')">主要技術</button>
                            <button class="nav-link text-sm sm:text-base px-3 py-2 font-medium rounded-md hover:bg-sky-500 focus:outline-none focus:ring-2 focus:ring-sky-400" onclick="showTab('applications')">応用とインパクト</button>
                            <button class="nav-link text-sm sm:text-base px-3 py-2 font-medium rounded-md hover:bg-sky-500 focus:outline-none focus:ring-2 focus:ring-sky-400" onclick="showTab('research')">最新研究</button>
                            <button class="nav-link text-sm sm:text-base px-3 py-2 font-medium rounded-md hover:bg-sky-500 focus:outline-none focus:ring-2 focus:ring-sky-400" onclick="showTab('local_implementation')">ローカル実装</button>
                        </div>
                    </div>
                </nav>

                <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 bg-white rounded-b-lg shadow-md">
                    <div id="overview" class="tab-content active">
                        <h2 class="text-2xl font-semibold text-slate-800 mb-6">RAGの概要と重要性</h2>
                        <div class="card">
                            <p class="mb-4">このセクションでは、Retrieval-Augmented Generation (RAG) の基本的な概念、LLMにおけるその重要性、そしてRAGが解決しようとする課題について概説します。RAGは、大規模言語モデル (LLM) が外部の知識ソースから情報を動的に検索し、それを応答生成に活用することで、より正確で最新の、文脈に即した情報を生成する技術です。</p>
                            <p class="mb-4">従来のLLMは、学習データに含まれる静的な知識（パラメトリック知識）に依存するため、ハルシネーション（事実に基づかない情報の生成）や知識の陳腐化といった課題を抱えていました。RAGは、これらの課題に対処し、LLMの信頼性と実用性を大幅に向上させることを目指しています。</p>
                            <p>このインタラクティブガイドを通じて、RAGの仕組み、主要な構成要素、関連技術、応用例、最新の研究動向、そしてご自身の環境でRAGシステムを構築するためのローカル実装方法まで、幅広く学ぶことができます。</p>
                        </div>
                    </div>

                    <div id="architecture" class="tab-content">
                        <h2 class="text-2xl font-semibold text-slate-800 mb-6">RAGの基本アーキテクチャ</h2>
                        <div class="card">
                            <p class="mb-4">RAGシステムは、主に「検索（Retrieval）」と「生成（Generation）」の2つの主要モジュールで構成されます。ユーザーのクエリに応じて、まずリトリーバーが外部知識ベースから関連情報を検索し、その情報をジェネレーター（LLM）が応答生成の際の追加コンテキストとして利用します。このセクションでは、これらのモジュールと、それらを繋ぐ「リトリーバル・フュージョン」について解説します。</p>
                        </div>

                        <div class="card">
                            <h3 class="text-xl font-semibold text-slate-800">RAGシステム全体像</h3>
                            <p class="mb-4">下の図はRAGシステムの基本的な流れを示しています。各コンポーネントをクリックすると詳細が表示されます。</p>
                            <div class="flex flex-col sm:flex-row items-center justify-around p-4 space-y-4 sm:space-y-0 sm:space-x-4">
                                <div class="diagram-component" onclick="showArchitecturalDetail('queryInput')">ユーザー入力 (クエリ)</div>
                                <div class="arrow hidden sm:flex">&rarr;</div>
                                <div class="diagram-component" onclick="showArchitecturalDetail('retrieverModule')">リトリーバーモジュール</div>
                                <div class="arrow hidden sm:flex">&rarr;</div>
                                <div class="diagram-component" onclick="showArchitecturalDetail('fusionModule')">リトリーバル・フュージョン</div>
                                <div class="arrow hidden sm:flex">&rarr;</div>
                                <div class="diagram-component" onclick="showArchitecturalDetail('generatorModule')">ジェネレーターモジュール (LLM)</div>
                                <div class="arrow hidden sm:flex">&rarr;</div>
                                <div class="diagram-component" onclick="showArchitecturalDetail('finalOutput')">最終出力</div>
                            </div>
                            <div id="architecturalDetailText" class="mt-6 p-4 bg-sky-50 border border-sky-200 rounded-md text-slate-700 hidden">
                                ここに詳細が表示されます。
                            </div>
                        </div>
                        
                        <div class="card">
                            <h3 class="text-xl font-semibold text-slate-800">リトリーバーモジュール</h3>
                            <p class="mb-4">リトリーバーは、外部知識を検索する役割を担います。主にエンコーダー、効率的なインデックス、データストアから構成されます。</p>
                            <ul class="list-disc list-inside space-y-2 mb-4">
                                <li><strong>エンコーダー:</strong> テキストデータを数値ベクトル（埋め込み）に変換し、意味情報を捉えます。</li>
                                <li><strong>効率的なインデックス:</strong> 大量の埋め込みベクトルから類似データを高速に検索する仕組み (例: ANN検索)。</li>
                                <li><strong>データストア:</strong> 外部知識をキーバリュー形式で保存します。</li>
                            </ul>
                            <p class="mb-2"><strong>リトリーバー構築のプロセス:</strong></p>
                            <ul class="list-decimal list-inside space-y-1 ml-4">
                                <li><strong>チャンキング戦略:</strong> ドキュメントを管理しやすいチャンクに分割。固定長、セマンティック、コンテンツベースなど。</li>
                                <li><strong>エンコーディング方法:</strong> スパースエンコーディング (TF-IDF等) や高密度エンコーディング (BERT等) を用いてチャンクをベクトル化。</li>
                                <li><strong>インデックス構築:</strong> 類似度指標の選択、次元削減、高度なANNインデックス作成 (HNSW等) により検索を高速化。</li>
                            </ul>
                        </div>

                        <div class="card">
                            <h3 class="text-xl font-semibold text-slate-800">ジェネレーターモジュール</h3>
                            <p class="mb-4">ジェネレーターは、通常LLMであり、入力と検索された情報に基づいて応答を生成します。デフォルトジェネレーター (GPT等) と、検索結果を融合する特定モジュールを持つRAジェネレーターがあります。</p>
                        </div>

                        <div class="card">
                             <h3 class="text-xl font-semibold text-slate-800">リトリーバル・フュージョン</h3>
                            <p class="mb-4">取得された知識をジェネレーターに統合する方法です。主な手法は以下の通りです。</p>
                            <div class="space-y-3">
                                <div>
                                    <button class="w-full text-left p-3 bg-slate-200 hover:bg-slate-300 rounded-md focus:outline-none accordion-toggle" data-target="fusion-query">
                                        <strong>クエリベースの融合 (Query-based Fusion)</strong>
                                    </button>
                                    <div id="fusion-query" class="accordion-content p-3 bg-white border rounded-b-md">
                                        取得した情報を入力クエリと統合して応答を生成する最もシンプルな方法。テキスト連結や特徴量連結があります。APIアクセスのみのLLMに適しています。
                                        <br><strong>利点:</strong> シンプル、生の情報を保持、適用容易。
                                        <br><strong>制限:</strong> 入力長増加、計算コスト増、文脈統合能力やスケーラビリティに限界。
                                    </div>
                                </div>
                                <div>
                                    <button class="w-full text-left p-3 bg-slate-200 hover:bg-slate-300 rounded-md focus:outline-none accordion-toggle" data-target="fusion-logits">
                                        <strong>ロジットベースの融合 (Logits-based Fusion)</strong>
                                    </button>
                                    <div id="fusion-logits" class="accordion-content p-3 bg-white border rounded-b-md">
                                        取得知識をジェネレーターの出力層（ロジット）に組み込む方法。アンサンブルベースやキャリブレーションベースがあります。
                                        <br><strong>利点:</strong> 計算効率が高い、検索と生成プロセスを分離。
                                        <br><strong>制限:</strong> 文脈統合が浅い、複雑な推論タスクで性能が劣る可能性。
                                    </div>
                                </div>
                                <div>
                                    <button class="w-full text-left p-3 bg-slate-200 hover:bg-slate-300 rounded-md focus:outline-none accordion-toggle" data-target="fusion-latent">
                                        <strong>潜在融合 (Latent Fusion)</strong>
                                    </button>
                                    <div id="fusion-latent" class="accordion-content p-3 bg-white border rounded-b-md">
                                        取得知識をジェネレーターの隠れ状態（中間表現）にマージする方法。アテンションベースや重み付き加算融合があります。
                                        <br><strong>利点:</strong> スケーラブルで効率的、深く文脈を意識した統合、きめ細かい制御。
                                        <br><strong>制限:</strong> 大幅なアーキテクチャ変更と慎重なトレーニングが必要、解釈可能性が低い場合がある。
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="technologies" class="tab-content">
                        <h2 class="text-2xl font-semibold text-slate-800 mb-6">RAGの主要技術とアルゴリズム</h2>
                        <p class="mb-6 card">このセクションでは、RAGシステムを支える核心技術である「埋め込みモデル」「類似度検索ライブラリ」「リランキング技術」について詳しく解説します。これらの技術がどのように連携し、RAGの性能を左右するのかを理解することができます。</p>

                        <div class="card">
                            <h3 class="text-xl font-semibold text-slate-800">埋め込みモデル</h3>
                            <p class="mb-4">テキスト埋め込みは、テキストを数値ベクトルに変換し、モデルが意味的な類似性に基づいて情報を処理・比較できるようにする技術です。適切な埋め込みモデルの選択はRAGシステムの性能に不可欠です。</p>
                            <p class="mb-4"><strong>選択パラメータ:</strong> コンテキストウィンドウ、トークン化単位、次元数、語彙サイズ、学習データ、コスト、品質 (MTEBスコア) など。</p>
                            <div class="chart-container my-6">
                                <canvas id="embeddingModelsChart"></canvas>
                            </div>
                            <p class="text-sm text-slate-600 mt-2 text-center">代表的な埋め込みモデルのMTEBスコア比較 (高いほど良い)。詳細はツールチップで確認できます。</p>
                            <div class="mt-4">
                                <label for="embeddingChartMetric" class="block text-sm font-medium text-slate-700 mb-1">比較指標の選択:</label>
                                <select id="embeddingChartMetric" class="block w-full sm:w-1/2 md:w-1/3 p-2 border border-slate-300 rounded-md shadow-sm focus:ring-sky-500 focus:border-sky-500">
                                    <option value="mteb">MTEBスコア</option>
                                    <option value="contextWindow">コンテキストウィンドウ (トークン数)</option>
                                    <option value="dimensions">次元数</option>
                                </select>
                            </div>
                        </div>

                        <div class="card">
                            <h3 class="text-xl font-semibold text-slate-800">類似度検索ライブラリ</h3>
                            <p class="mb-4">ベクトル検索ライブラリは、大量のベクトル埋め込みの中からクエリに類似したアイテムを高速に見つけ出すために使用されます。</p>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div class="p-4 border rounded-lg bg-white">
                                    <h4 class="font-semibold text-lg text-sky-700">Annoy (Approximate Nearest Neighbors Oh Yeah)</h4>
                                    <p class="text-sm">メモリ効率が高く、速度重視。静的な大規模データセット向き。インデックスは不変。</p>
                                </div>
                                <div class="p-4 border rounded-lg bg-white">
                                    <h4 class="font-semibold text-lg text-sky-700">Faiss (Facebook AI Similarity Search)</h4>
                                    <p class="text-sm">GPUアクセラレーション対応。速度と精度のトレードオフ調整可能。大規模・動的データセット向き。</p>
                                </div>
                                <div class="p-4 border rounded-lg bg-white">
                                    <h4 class="font-semibold text-lg text-sky-700">NMSLIB (Non Metric Space Library)</h4>
                                    <p class="text-sm">拡張性が高く、多様な検索方法や距離関数を追加可能。高次元データ向き。</p>
                                </div>
                                <div class="p-4 border rounded-lg bg-white">
                                    <h4 class="font-semibold text-lg text-sky-700">HNSW (Hierarchical Navigable Small World)</h4>
                                    <p class="text-sm">多層グラフ構造による効率的でスケーラブルな検索。ベクトルデータベースで多用。</p>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <h3 class="text-xl font-semibold text-slate-800">リランキング技術</h3>
                            <p class="mb-4">リランキングは、初期検索結果をさらにフィルタリングし、LLMに渡す情報の質と関連性を高める重要なステップです。LLMの想起能力を最大化します。</p>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-semibold text-lg text-sky-700">Bi-Encoder</h4>
                                    <p class="mb-2">クエリとパッセージを独立してエンコードし、ベクトル類似度で関連性を計算。</p>
                                    <p class="text-sm mb-1"><strong>利点:</strong> 高速・スケーラブル。</p>
                                    <p class="text-sm"><strong>欠点:</strong> 微妙な意味的ニュアンスの把握が難しい場合がある。</p>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-lg text-sky-700">Cross-Encoder</h4>
                                    <p class="mb-2">クエリとパッセージをペアで入力し、相互作用をモデル化して関連性スコアを計算。</p>
                                    <p class="text-sm mb-1"><strong>利点:</strong> 高精度。</p>
                                    <p class="text-sm"><strong>欠点:</strong> 計算負荷が高い、スケーラビリティが低い。</p>
                                </div>
                            </div>
                            <div class="mt-6 p-4 bg-sky-50 border border-sky-200 rounded-md">
                                <h4 class="font-semibold text-md text-sky-800 mb-2">二段階検索システム</h4>
                                <p class="text-sm">一般的なアプローチとして、まずBi-Encoderで高速に候補を絞り込み、次にCross-Encoderで上位候補をリランキングすることで、効率と精度のバランスを取ります。DynamicRAGのような動的調整フレームワークも研究されています。</p>
                            </div>
                        </div>
                    </div>

                    <div id="applications" class="tab-content">
                        <h2 class="text-2xl font-semibold text-slate-800 mb-6">RAGの応用とインパクト</h2>
                        <p class="mb-6 card">RAGは、LLMの課題を克服し、その実用性を飛躍的に高める技術です。このセクションでは、RAGがもたらす主な利点と、具体的なユースケース、そして導入・運用時の考慮事項について解説します。</p>

                        <div class="card">
                            <h3 class="text-xl font-semibold text-slate-800">RAGの主な利点</h3>
                            <ul class="list-disc list-inside space-y-2">
                                <li><strong>ハルシネーションの削減:</strong> 応答を外部情報源に固定し、信頼性を向上。</li>
                                <li><strong>知識の最新性:</strong> リアルタイムで最新情報にアクセス可能。</li>
                                <li><strong>ドメイン固有の精度向上:</strong> 専門知識ベースの活用。</li>
                                <li><strong>コスト効率の良いカスタマイズ:</strong> プライベートLLM構築より迅速かつ低コスト。</li>
                                <li><strong>トレーサビリティとコンプライアンス:</strong> 情報源の特定が可能。</li>
                                <li><strong>長文クエリの処理能力向上:</strong> 関連スニペットの取得による文脈理解。</li>
                            </ul>
                        </div>

                        <div class="card">
                            <h3 class="text-xl font-semibold text-slate-800">主要なユースケース</h3>
                            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <div class="p-4 border rounded-lg bg-white hover:shadow-md transition-shadow"><strong>企業知識管理:</strong> 社内文書を活用したインテリジェントな知識ベース。</div>
                                <div class="p-4 border rounded-lg bg-white hover:shadow-md transition-shadow"><strong>顧客サポート:</strong> FAQや製品情報に基づくパーソナライズされた回答。</div>
                                <div class="p-4 border rounded-lg bg-white hover:shadow-md transition-shadow"><strong>法務・コンプライアンス:</strong> 法的文書からの迅速な情報抽出と正確な情報提供。</div>
                                <div class="p-4 border rounded-lg bg-white hover:shadow-md transition-shadow"><strong>医療アプリケーション:</strong> 最新医学研究や患者記録に基づく情報提供。</div>
                                <div class="p-4 border rounded-lg bg-white hover:shadow-md transition-shadow"><strong>研究開発:</strong> 既存文献からの関連情報取得による研究支援。</div>
                                <div class="p-4 border rounded-lg bg-white hover:shadow-md transition-shadow"><strong>教育システム:</strong> カリキュラムに基づく正確な説明。</div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <h3 class="text-xl font-semibold text-slate-800">導入・運用時の考慮事項</h3>
                             <ul class="list-disc list-inside space-y-2">
                                <li><strong>技術インフラ要件:</strong> ベクトルDB、高性能計算リソース(GPU等)、データパイプライン。</li>
                                <li><strong>データ準備と管理:</strong> 高品質なデータソースの特定、前処理、継続的更新。</li>
                                <li><strong>既存システムとの統合:</strong> 既存DBやAPIとのシームレスな連携。</li>
                                <li><strong>評価指標とパフォーマンス監視:</strong> 接地性、完全性、利用率、関連性、正確性など。</li>
                                <li><strong>セキュリティと制御:</strong> データ保存・処理の地域選択、監査証跡、セキュリティ監視。</li>
                            </ul>
                             <p class="mt-4 p-3 bg-sky-50 border border-sky-200 rounded-md text-sm">RAGは、企業がLLMを実用的に導入するための現実的な経路を提供します。プライベートLLMと比較して開発期間が短く、初期投資も抑えられ、専門知識の要件も低減されます。特にデータプライバシーや規制遵守が求められる分野で有効です。</p>
                        </div>
                    </div>

                    <div id="research" class="tab-content">
                        <h2 class="text-2xl font-semibold text-slate-800 mb-6">RAGの最新研究動向と将来展望</h2>
                        <p class="mb-6 card">RAGは急速に進化しており、より洗練され、適応性があり、堅牢なシステムを目指した研究が進められています。このセクションでは、適応型RAG、マルチホップQAにおけるRAG、その他のRAGバリエーション、そしてセキュリティに関する最新の動向を概観します。</p>

                        <div class="card">
                            <h3 class="text-xl font-semibold text-slate-800">適応型RAG (Adaptive RAG)</h3>
                            <p class="mb-4">従来のRAGが常に外部情報を検索するのに対し、適応型RAGは外部知識が必要な場合にのみ検索を行うことで、計算コストを削減し、効率を向上させることを目指します。</p>
                            <ul class="list-disc list-inside space-y-1">
                                <li><strong>Adaptive RAG:</strong> 分類器を用いて検索の必要性を予測。</li>
                                <li><strong>Self-RAG:</strong> LLM自身がオンデマンドで検索し、取得情報と自己生成について「反射トークン」を用いて反省・改善する。</li>
                                <li><strong>LLM-Independent Adaptive RAG:</strong> LLMに依存せず、エンティティ人気度などの外部情報で検索要否を判断し効率化。</li>
                            </ul>
                        </div>
                        
                        <div class="card">
                            <h3 class="text-xl font-semibold text-slate-800">マルチホップQAにおけるRAG</h3>
                            <p class="mb-4">複雑な質問に対し、複数の情報を段階的に検索・推論して回答を導き出すマルチホップQAはRAGにとって大きな課題です。</p>
                            <ul class="list-disc list-inside space-y-1">
                                 <li><strong>PAR RAG (Plan-then-Act-and-Review RAG):</strong> 人間の認知に着想を得て、グローバルな計画立案と各ステップでの厳密な検証を組み合わせることで、推論パスの逸脱や中間結果のエラーを軽減するフレームワーク。</li>
                            </ul>
                        </div>

                        <div class="card">
                            <h3 class="text-xl font-semibold text-slate-800">その他のRAGバリエーション</h3>
                            <p class="mb-4">RAGの基本フレームワークから派生した多様なアプローチが研究されています。</p>
                            <div class="space-y-3">
                                <details class="group bg-white p-3 rounded-md shadow hover:shadow-lg transition-shadow">
                                    <summary class="font-semibold cursor-pointer group-hover:text-sky-600">Standard RAG / Corrective RAG / Speculative RAG</summary>
                                    <p class="text-sm mt-2 text-slate-600"><strong>Standard RAG:</strong> 基本的な検索・生成モデル。<br><strong>Corrective RAG:</strong> 生成応答の誤りを修正する層を追加。高精度ドメイン向け。<br><strong>Speculative RAG:</strong> データ不十分時に推測的応答を許容。探索的研究向け。</p>
                                </details>
                                <details class="group bg-white p-3 rounded-md shadow hover:shadow-lg transition-shadow">
                                    <summary class="font-semibold cursor-pointer group-hover:text-sky-600">Fusion RAG / Agentic RAG / Self RAG</summary>
                                    <p class="text-sm mt-2 text-slate-600"><strong>Fusion RAG:</strong> 複数情報源を統合して応答作成。複雑な意思決定向け。<br><strong>Agentic RAG:</strong> モデルが自律的に情報取得方法を決定。動的環境向け。<br><strong>Self RAG (再掲):</strong> 自己評価・反省により応答品質を向上。</p>
                                </details>
                                 <details class="group bg-white p-3 rounded-md shadow hover:shadow-lg transition-shadow">
                                    <summary class="font-semibold cursor-pointer group-hover:text-sky-600">Graph RAG / Modular RAG / RadioRAG</summary>
                                    <p class="text-sm mt-2 text-slate-600"><strong>Graph RAG:</strong> グラフ構造データを活用し、エンティティ間の関係に基づいて検索。深い関係理解が必要なドメイン向け。<br><strong>Modular RAG:</strong> 検索・生成コンポーネントを独立モジュール化し、柔軟性とカスタマイズ性を向上。<br><strong>RadioRAG:</strong> 放射線医学向け。リアルタイムでドメイン固有情報を取得。</p>
                                </details>
                            </div>
                        </div>
                        
                        <div class="card">
                            <h3 class="text-xl font-semibold text-slate-800">セキュリティの課題: PoisonedRAG</h3>
                            <p class="mb-4">RAGシステムの進化は新たなセキュリティ課題も生んでいます。特に「PoisonedRAG」は、知識データベースへの悪意あるテキスト注入による知識汚染攻撃を示しており、LLMの出力を操作される危険性があります。</p>
                            <p class="text-sm p-3 bg-red-50 border border-red-200 rounded-md text-red-700">既存の防御策は不十分な場合があり、新たな防御メカニズムの開発が不可欠です。特に高リスクな応用分野ではセキュリティが将来のRAG開発における重要課題となります。</p>
                        </div>
                    </div>

                    <div id="local_implementation" class="tab-content">
                        <h2 class="text-2xl font-semibold text-slate-800 mb-6">RAGのローカル実装方法</h2>
                        <p class="mb-6 card">RAGシステムをローカル環境で実装することは、データプライバシーの強化、レイテンシの削減、オフライン利用といった大きな利点をもたらします。このセクションでは、ローカル実装のメリット、必要なハードウェアとソフトウェア、そして具体的な実装ステップについて解説します。</p>

                        <div class="card">
                            <h3 class="text-xl font-semibold text-slate-800">ローカル実装の利点</h3>
                            <ul class="list-disc list-inside space-y-2">
                                <li><strong>データプライバシーの強化:</strong> 機密データをオンプレミスで処理し、情報漏洩リスクを低減。</li>
                                <li><strong>レイテンシの削減:</strong> クラウド経由より高速な応答。リアルタイム性が求められる応用に。</li>
                                <li><strong>オフライン利用:</strong> インターネット接続なしでのAI機能利用。</li>
                            </ul>
                        </div>

                        <div class="card">
                            <h3 class="text-xl font-semibold text-slate-800">ハードウェア要件</h3>
                            <p class="mb-4">ローカルRAGシステムを効率的に実行するための一般的なハードウェア構成です。</p>
                            <div class="chart-container my-6">
                                <canvas id="hardwareChart"></canvas>
                            </div>
                            <p class="text-sm text-slate-600 mt-2 text-center">CPU、RAM、GPU VRAMの最小要件と推奨要件の比較。</p>
                            <ul class="list-disc list-inside space-y-1 mt-4 text-sm">
                                <li><strong>CPU:</strong> マルチコア (最低)、16コア以上 (推奨)。GPU1基あたり最低4コア。</li>
                                <li><strong>RAM:</strong> 16GB (最低)、32GB以上 (推奨)。GPU VRAMの2倍量が目安。</li>
                                <li><strong>GPU:</strong> NVIDIA GPU 8GB VRAM (最低)、RTX 4080/4090 (推奨)。</li>
                                <li><strong>ストレージ:</strong> 高速NVMe SSD (必須)、複数ドライブ (推奨)。</li>
                            </ul>
                        </div>

                        <div class="card">
                            <h3 class="text-xl font-semibold text-slate-800">必要なソフトウェアとライブラリ</h3>
                            <ul class="list-disc list-inside space-y-2">
                                <li><strong>プログラミング言語:</strong> Python (推奨)。</li>
                                <li><strong>環境管理:</strong> 仮想環境 (venv, Conda)。</li>
                                <li><strong>主要ライブラリ:</strong>
                                    <ul class="list-circle list-inside ml-4">
                                        <li>`torch`, `transformers`, `datasets` (基本機能)</li>
                                        <li>Ollama (ローカルモデル実行)</li>
                                        <li>LangChain (LLMパイプライン構築)</li>
                                        <li>ベクトルデータベース (ChromaDB, MongoDB等)</li>
                                        <li>Unstructured (ドキュメント処理)</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <div class="card">
                            <h3 class="text-xl font-semibold text-slate-800">実装ステップ概要</h3>
                            <ol class="list-decimal list-inside space-y-3">
                                <li><strong>環境構築:</strong> Python, 仮想環境設定, ライブラリインストール, Ollama設定 (LLMと埋め込みモデルのプル)。Docker推奨。</li>
                                <li><strong>データ準備:</strong> 高品質データセットの特定・取得・クリーニング。チャンキング戦略 (例: 1200文字チャンク, 300文字オーバーラップ)。埋め込みの事前ロード。</li>
                                <li><strong>リトリーバー構築:</strong> 基本リトリーバー実装、ベクトルDB設定。</li>
                                <li><strong>ジェネレーター開発:</strong> 選択したLLMを設定。必要に応じて埋め込みをファインチューニング。</li>
                                <li><strong>システム統合とテスト:</strong> リトリーバーとジェネレーターの連携。包括的テストと反復改善。</li>
                                <li><strong>ファインチューニングと最適化:</strong>
                                    <ul class="list-disc list-inside ml-4 text-sm">
                                        <li>チャンキング戦略改善 (セマンティックチャンキング等)。</li>
                                        <li>リランキング導入 (Cohere, Voyageモデル等)。</li>
                                        <li>ベクトル検索最適化 (次元削減、HNSW設定調整等)。</li>
                                        <li>リソース管理 (GPUメモリ、バッチ処理、量子化等)。</li>
                                        <li>プロンプト圧縮。</li>
                                        <li>データプライバシーのベストプラクティス (ローカル処理、暗号化等)。</li>
                                    </ul>
                                </li>
                                <li><strong>デプロイ:</strong> デプロイ準備とプラットフォーム選択。Docker推奨。</li>
                            </ol>
                        </div>
                    </div>
                </div>
                <div class="article-navigation">
                    <a href="../deep_research/index.html" class="back-to-list">&lt; Deep Research一覧へ戻る</a>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Masato Izumi Portfolio</p>
        </div>
    </footer>
    
    <div id="tooltip" class="tooltip"></div>

    <script src="../js/main.js"></script> 
    <script>
        // Deep Researchページ専用のJavaScript
        const tabs = document.querySelectorAll('.nav-link');
        const tabContents = document.querySelectorAll('.tab-content');
        let embeddingChart = null;
        let hardwareChart = null;

        function showTab(tabId) {
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');

            tabs.forEach(tab => {
                tab.classList.remove('active');
                tab.classList.add('hover:bg-sky-500'); // Tailwind class
                if (tab.getAttribute('onclick').includes(tabId)) {
                    tab.classList.add('active');
                    tab.classList.remove('hover:bg-sky-500');
                }
            });
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const targetTab = tab.getAttribute('onclick').match(/'([^']+)'/)[1];
                showTab(targetTab);
            });
        });
        
        const accordionToggles = document.querySelectorAll('.accordion-toggle');
        accordionToggles.forEach(toggle => {
            toggle.addEventListener('click', () => {
                const targetId = toggle.dataset.target;
                const targetContent = document.getElementById(targetId);
                targetContent.classList.toggle('open');
                // Optional: Close other accordions when one opens
                accordionToggles.forEach(otherToggle => {
                    if (otherToggle !== toggle) {
                        document.getElementById(otherToggle.dataset.target).classList.remove('open');
                    }
                });
            });
        });

        const architecturalComponents = {
            queryInput: "<strong>ユーザー入力 (クエリ):</strong> RAGプロセスの起点。ユーザーが知りたい情報や質問を自然言語で入力します。",
            retrieverModule: "<strong>リトリーバーモジュール:</strong> クエリに基づいて、外部の知識ベース（ドキュメント、データベースなど）から関連性の高い情報を検索・取得します。エンコーダー、インデックス、データストアで構成されます。",
            fusionModule: "<strong>リトリーバル・フュージョン:</strong> 取得された情報を、LLMが利用しやすいように元のクエリやLLMの中間状態と統合するプロセスです。クエリベース、ロジットベース、潜在融合などの手法があります。",
            generatorModule: "<strong>ジェネレーターモジュール (LLM):</strong> 元のクエリと、リトリーバーが取得しフュージョンされた情報をコンテキストとして利用し、最終的な応答を生成する大規模言語モデルです。",
            finalOutput: "<strong>最終出力:</strong> RAGシステムによって生成された、より正確で、文脈に即した、情報に基づいた応答です。"
        };

        function showArchitecturalDetail(componentKey) {
            const detailTextElement = document.getElementById('architecturalDetailText');
            if (architecturalComponents[componentKey]) {
                detailTextElement.innerHTML = architecturalComponents[componentKey];
                detailTextElement.classList.remove('hidden');
            } else {
                detailTextElement.innerHTML = '詳細情報が見つかりません。';
                detailTextElement.classList.remove('hidden');
            }
        }
        
        const embeddingModelData = [
            { name: "OpenAI text-embedding-ada-002", mteb: 61.0, contextWindow: 8192, dimensions: 1536, cost: 0.10 },
            { name: "NVIDIA NV-Embed-v2", mteb: 72.31, contextWindow: 32768, dimensions: 4096, cost: 0 }, // Open-source
            { name: "OpenAI text-embedding-3-large", mteb: 64.6, contextWindow: 8192, dimensions: 3072, cost: 0.13 },
            { name: "OpenAI text-embedding-3-small", mteb: 62.3, contextWindow: 8192, dimensions: 1536, cost: 0.02 },
            { name: "Gemini text-embedding-004", mteb: 60.8, contextWindow: 2048, dimensions: 768, cost: 0 }, // Not available (assuming free tier)
            { name: "Jina Embeddings v3", mteb: 59.5, contextWindow: 8192, dimensions: 1024, cost: 0 }, // Open-source
            { name: "Cohere embed-english-v3.0", mteb: 64.5, contextWindow: 512, dimensions: 1024, cost: 0.10 },
            { name: "voyage-3-large", mteb: 60.5, contextWindow: 32000, dimensions: 2048, cost: 0.06 },
            { name: "BAAI/bge-base-en-v1.5", mteb: 60.0, contextWindow: 512, dimensions: 768, cost: 0 } // Open-source
        ];

        embeddingModelData.sort((a, b) => b.mteb - a.mteb); // Default sort by MTEB

        const tooltipEl = document.getElementById('tooltip');

        function createEmbeddingChart(metric = 'mteb') {
            const ctx = document.getElementById('embeddingModelsChart').getContext('2d');
            
            let sortedData = [...embeddingModelData];
            let labelText = '';
            let dataValues = [];

            if (metric === 'mteb') {
                sortedData.sort((a, b) => b.mteb - a.mteb);
                labelText = 'MTEBスコア (高いほど良い)';
                dataValues = sortedData.map(d => d.mteb);
            } else if (metric === 'contextWindow') {
                sortedData.sort((a, b) => b.contextWindow - a.contextWindow);
                labelText = 'コンテキストウィンドウ (トークン数)';
                dataValues = sortedData.map(d => d.contextWindow);
            } else if (metric === 'dimensions') {
                sortedData.sort((a, b) => b.dimensions - a.dimensions); // Higher might not always be better, but for sorting.
                labelText = '次元数';
                dataValues = sortedData.map(d => d.dimensions);
            }
            
            const labels = sortedData.map(d => d.name.length > 25 ? d.name.substring(0,22) + '...' : d.name);


            if (embeddingChart) {
                embeddingChart.destroy();
            }
            embeddingChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: labelText,
                        data: dataValues,
                        backgroundColor: 'rgba(59, 130, 246, 0.7)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: { display: true, text: labelText }
                        },
                        y: {
                            ticks: { autoSkip: false, maxRotation: 0, minRotation: 0 }
                        }
                    },
                    plugins: {
                        legend: { display: true, position: 'top' },
                        tooltip: {
                            enabled: false, // Disable default tooltip
                            external: function(context) {
                                const tooltipModel = context.tooltip;
                                if (tooltipModel.opacity === 0) {
                                    tooltipEl.style.opacity = '0';
                                    return;
                                }
                                tooltipEl.style.opacity = '1';
                                tooltipEl.style.left = tooltipModel.caretX + 'px';
                                tooltipEl.style.top = tooltipModel.caretY + 'px';
                                
                                const dataIndex = tooltipModel.dataPoints[0].dataIndex;
                                const model = sortedData[dataIndex];
                                tooltipEl.innerHTML = `<strong>${model.name}</strong><br>
                                    MTEB: ${model.mteb}<br>
                                    Context: ${model.contextWindow} tokens<br>
                                    Dimensions: ${model.dimensions}<br>
                                    Cost/1M: $${model.cost > 0 ? model.cost.toFixed(2) : (model.cost === 0 ? 'Free/OS' : 'N/A')}`;
                            }
                        }
                    }
                }
            });
        }
        
        document.getElementById('embeddingChartMetric').addEventListener('change', function() {
            createEmbeddingChart(this.value);
        });


        const hardwareData = {
            labels: ['CPU (コア数)', 'RAM (GB)', 'GPU VRAM (GB)'],
            datasets: [
                {
                    label: '最小要件',
                    data: [4, 16, 8], // Example: min CPU cores, min RAM, min GPU VRAM
                    backgroundColor: 'rgba(251, 146, 60, 0.7)', // Orange
                    borderColor: 'rgba(251, 146, 60, 1)',
                    borderWidth: 1
                },
                {
                    label: '推奨要件',
                    data: [16, 32, 16], // Example: rec CPU cores, rec RAM, rec GPU VRAM (using 4080/4090 as a proxy for 16GB+)
                    backgroundColor: 'rgba(59, 130, 246, 0.7)', // Blue
                    borderColor: 'rgba(59, 130, 246, 1)',
                    borderWidth: 1
                }
            ]
        };

        function createHardwareChart() {
            const ctx = document.getElementById('hardwareChart').getContext('2d');
            if (hardwareChart) {
                hardwareChart.destroy();
            }
            hardwareChart = new Chart(ctx, {
                type: 'bar',
                data: hardwareData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: '要件値' }
                        }
                    },
                    plugins: {
                        legend: { display: true, position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y + (context.datasetIndex === 0 || context.datasetIndex === 1 ? (context.label.includes('CPU') ? ' コア' : ' GB') : '');
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Initial chart creations
        document.addEventListener('DOMContentLoaded', () => {
            showTab('overview'); // Show the first tab by default
            createEmbeddingChart(); // Default to MTEB
            createHardwareChart();
        });

    </script>
</body>
</html>